{"version":3,"sources":["js/es6/content_script/tooltip.js"],"names":[],"mappings":"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","file":"js/es6/content_script/tooltip.js","sourcesContent":["// TODO вынести настройки подключения в settings.js\n//var HOST = 'http://tran-service.com'\nvar HOST = 'http://localhost:5000';\n\nvar TOOLTIP_CLASS_PREFIX = '__mtt_translate_dialog__';\nvar ctrlDown = false;\nvar ctrlKey = 17;\nvar cmdKey = 91;\nvar cKey = 67;\nvar add_title = 'Добавить в персональный словарь';\n\nvar _ = require('../utils.js');\n\nclass Tooltip {\n  constructor (coordinates) {\n    this.setListeners();\n    this.clickTarget = null;\n  }\n\n  createEl (storage) {\n    this.el = document.createElement('div');\n    this.memorizeButton = this.createMemoBtn();\n    this.elContainer = this.createContainer();\n    this.el.appendChild(this.memorizeButton);\n    this.el.appendChild(this.elContainer);\n    this.el.classList.add(TOOLTIP_CLASS_PREFIX);\n    this.addListeners();\n\n  }\n\n  addListeners () {\n    this.el.addEventListener('mousedown', e => e.stopPropagation());\n    this.el.addEventListener('keydown', this.onKeyDown);\n    this.memorizeButton.addEventListener('click', this.memoClick);\n  }\n\n  createMemoBtn () {\n    var t = document.createElement('template');\n    var tmpl = `<a title=\"${add_title}\"\n                   class=\"btn-floating waves-effect waves-light blue word-add\">\n                  <i class=\"material-icons\">+</i>\n                </a>`;\n    t.innerHTML = tmpl;\n    return t.content;\n  }\n\n  memoClick (e) {\n    e.stopPropagation();\n    e.preventDefault();\n    _.post(HOST+'/api/plugin/add_word/', {data: 'blabla'});\n  }\n\n  createContainer () {\n    var docFragment = document.createDocumentFragment();\n    var container = document.createElement('div');\n    container.classList.add(TOOLTIP_CLASS_PREFIX + 'container');\n    return container;\n  }\n\n  onKeyDown (e) {\n    if (ctrlDown && (e.keyCode == vKey || e.keyCode == cKey)) {\n      e.stopPropagation();\n      return true;\n    }\n  }\n\n  setListeners () {\n    window.addEventListener('mousedown', e => this.destroy(e));\n    document.addEventListener('mousedown', e => this.destroy(e));\n    window.addEventListener('blur', e => this.destroy(e));\n    document.addEventListener('keydown', e => this.keydown(e));\n    document.addEventListener('keyup', e => this.keyup(e));\n  }\n\n  render (data, transform = null) {\n      if (!this.el) {\n        this.createEl();\n      }\n      this.checkMemorize();\n      this.elContainer.innerHTML = data;\n      if (transform) { transform(this.el) }\n      this.el.style.left = this.coordinates.mouseX + 'px';\n      this.el.style.top = this.coordinates.mouseY + 'px';\n      document.body.appendChild(this.el);\n      if (this.coordinates.mouseX + this.el.offsetWidth > window.innerWidth) {\n        this.el.style.left = (this.coordinates.mouseX - this.el.offsetWidth) + 'px';\n      }\n  }\n\n  checkMemorize () {\n    var self = this;\n    chrome.storage.sync.get({memorize: false, auth_token: null}, function (storage) {\n      if (storage.memorize && storage.auth_token) {\n        self.el.classList.add('memorize');\n      } else {\n        self.el.classList.remove('memorize');\n      }\n    });\n  }\n\n  keydown (e) {\n    if (e.keyCode == ctrlKey || e.keyCode == cmdKey) {\n      ctrlDown = true;\n    }\n    if (ctrlDown && (e.keyCode == ctrlKey || e.keyCode == cKey || e.keyCode == cmdKey)) {\n      return true;\n    } else {\n      this.destroy(e);\n    }\n  }\n\n  keyup (e) {\n    if (e.keyCode == ctrlKey) {\n      ctrlDown = false;\n    }\n  }\n\n  destroy (e) {\n    if (this.el && this.el.parentNode == document.body) {\n      document.body.removeChild(this.el);\n      this.el = null;\n      this.clickTarget = null;  // reset click target\n    }\n  }\n\n  setCoordinates (coordinates) {\n    this.coordinates = coordinates;\n  }\n}\n\nmodule.exports = Tooltip;"]}