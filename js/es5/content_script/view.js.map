{"version":3,"sources":["../../es6/content_script/view.js"],"names":[],"mappings":"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","file":"view.js","sourcesContent":["var Tooltip = require('./tooltip.js');\nvar TEXTBOX_TAGS = ['input', 'textarea'];\n\nclass Main {\n\n  constructor () {\n    this.addEventListeners();\n    this.coordinates = { mouseX: 0, mouseY: 0 };\n    this.tooltip = new Tooltip(this.coordinates);\n    chrome.runtime.onMessage.addListener(this.renderResult.bind(this));\n  }\n\n  addEventListeners () {\n    window.addEventListener('mousedown', e => this.mouseDownEvent(e));\n    document.addEventListener('mousedown', e => this.mouseDownEvent(e));\n    window.addEventListener('mouseup', e => this.mouseUpEvent(e));\n    document.addEventListener('contextmenu', e => this.saveMousePosition(e));\n  }\n\n  renderResult (msg) {\n    if (msg.action == 'open_tooltip' || msg.action == 'similar_words') {\n      //don't show annoying tooltip when typing\n      if (!msg.success && this.tooltip.clickTarget == 'textbox') {\n        return;\n      } else if (msg.action == 'similar_words') {\n        this.tooltip.render(msg.data, this.attachSimilarWordsHandlers.bind(this));\n      } else {\n        this.tooltip.render(msg.data)\n      }\n    }\n  }\n\n  requestSearch (selection) {\n    chrome.runtime.sendMessage({\n      method: \"request_search\",\n      data: {\n        selectionText: selection\n      }\n    })\n  }\n\n  saveMousePosition (e) {\n    this.coordinates.mouseX = e.pageX + 5;\n    this.coordinates.mouseY = e.pageY + 10;\n    this.tooltip.setCoordinates(this.coordinates);\n  }\n\n  mouseDownEvent (e) {\n    var tag = e.target.tagName.toLowerCase();\n    if (TEXTBOX_TAGS.indexOf(tag) != -1) {\n      this.tooltip.clickTarget = 'textbox';\n    }\n  }\n\n  mouseUpEvent (e) {\n    // fix for accidental tooltip appearance when clicked on text\n    setTimeout(this.clickHandler.bind(this, e), 10);\n    return true;\n  }\n\n  clickHandler (e) {\n    this.saveMousePosition(e);\n    var selection = this.getSelection();\n    var self = this;\n    if (selection.length > 0) {\n      chrome.storage.sync.get({fast: true}, function (items) {\n        if (items.fast) { self.requestSearch(selection); }\n      });\n    }\n  }\n\n  getSelection (e) {\n      var txt = window.getSelection().toString();\n      var span = document.createElement('SPAN');\n      span.innerHTML = txt;\n      var selection = span.textContent.trim();\n      return selection\n  }\n\n  attachSimilarWordsHandlers (fragment) {\n    for (let link of Array.from(fragment.querySelectorAll('a'))) {\n      // sanitize\n      link.removeAttribute('onclick');\n      link.onclick = null;\n      let clone = link.cloneNode(true);\n      link.parentNode.replaceChild(clone, link);\n      let word = clone.textContent;\n      // Prevent link from being followed.\n      clone.addEventListener('click', function (e) {\n        e.stopPropagation(); e.preventDefault();\n      });\n      // Don't let @mouseUpEvent fire again with the wrong word.\n      var self = this;\n      clone.addEventListener('mouseup', function (e) {\n        e.stopPropagation();\n        self.requestSearch(word);\n      })\n    }\n    return true;\n  }\n}\nmodule.exports = Main;\n"]}