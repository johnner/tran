{"version":3,"sources":["js/es6/turkishdictionary.js"],"names":[],"mappings":"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","file":"js/es6/turkishdictionary.js","sourcesContent":["/*\n  Translation engine: http://www.turkishdictionary.net\n  For translating turkish-russian and vice versa\n*/\nvar CHAR_CODES = require('./char-codes-turk.js');\n\nclass TurkishDictionary {\n  constructor() {\n  \tthis.host = 'http://www.turkishdictionary.net/?word=%FC';\n  \tthis.path = '';\n    this.protocol = 'http'\n    this.query = '&s='\n    this.TABLE_CLASS = '___mtt_translate_table';\n    // this flag indicates that if translation was successful then publish it all over extension\n    this.need_publish = true;\n  }\n\n  search (data) {\n    data.url = this.makeUrl(data.value);\n    this.need_publish = false;\n    return this.request(data);\n  }\n\n  translate(data) {\n    data.url = this.makeUrl(data.selectionText);\n    this.need_publish = true;\n    this.request(data);\n  }\n\n  makeUrl (text) {\n    var text = this.getEncodedValue(text);\n    return ['http://www.turkishdictionary.net/?word=', text].join('');\n  }\n\n\n  // Replace special language characters to html codes\n  getEncodedValue (value) {\n    // to find spec symbols we first encode them (raw search for that symbol doesn't wor)\n    return encodeURIComponent(value);\n    //return this.makeStringTransferable(value);\n  }\n\n    /** converting script from the turkishdict */\n  makeStringTransferable (inputText) {\n    var text = \"\";\n    if ( inputText.length > 0 ) {\n      text = inputText;\n      for(var i = 0; i < text.length; i++) {\n        if (CHAR_CODES[text.charCodeAt(i)]) {\n          text = text.substring(0, i) + CHAR_CODES[text.charCodeAt(i)] + text.substring(i+1, text.length);\n        } else if (text.charAt(i) == ' ') {\n            // replace spaces\n            text = text.substring(0, i) + '___' + text.substring(i+1, text.length);\n        }\n      }\n    }\n    return text;\n  }\n\n  /*\n    Request translation and run callback function\n    passing translated result or error to callback\n  */\n  request (opts) {\n    console.log('start request');\n    this.xhr = new XMLHttpRequest();\n    this.xhr.onreadystatechange = this.onReadyStateChange.bind(this, opts);\n    this.xhr.open(\"GET\", opts.url, true);\n    this.xhr.send();\n  }\n\n  onReadyStateChange (opts, e) {\n      let xhr = this.xhr;\n      if (xhr.readyState < 4) {\n        return;\n      }\n      else if (xhr.status != 200) {\n        this.errorHandler(xhr);\n        return opts.error && opts.error();\n      } else if (xhr.readyState == 4) {\n        let translation = this.successHandler(e.target.response);\n        console.log('success turkish translate', translation);\n        console.log('call', opts.success);\n        return opts.success && opts.success(translation);\n      }\n  }\n\n  successHandler (response) {\n    var data = this.parse(response);\n    if (this.need_publish) {\n      chrome.tabs.getSelected(null, this.publishTranslation.bind(this, data));\n    }\n    return data;\n  }\n\n  /* publish successfuly translated text all over extension */\n  publishTranslation (translation, tab) {\n    console.log('publish translation');\n    chrome.tabs.sendMessage(tab.id, {\n      action: this.tooltipAction(translation),\n      data: translation.outerHTML,\n      success: !translation.classList.contains('failTranslate')\n    });\n  }\n\n  tooltipAction (translation) {\n    if (translation.textContent.trim().indexOf('was not found in our dictionary') != -1) {\n      console.log('similar words')\n      return 'similar_words';\n    } else {\n      console.log('open tooltip')\n      return 'open_tooltip';\n    }\n  }\n\n  errorHandler (response) {\n    console.log('error ajax', response);\n  }\n\n  /* Parse response from translation engine */\n  parse (response, silent, translate) {\n    var doc = this.stripScripts(response),\n        fragment = this.makeFragment(doc);\n    if (fragment) {\n      translate = fragment.querySelector('#meaning_div > table');\n      if (translate) {\n        translate.className = this.TABLE_CLASS;\n        translate.setAttribute(\"cellpadding\", \"5\");\n        // @fixImages(translate)\n        // @fixLinks(translate)\n      } else if (!silent) {\n        translate = document.createElement('div')\n        translate.className = 'failTranslate';\n        translate.innerText = \"Unfortunately, could not translate\";\n      }\n    }\n    return translate;\n  }\n\n  /** parsing of terrible html markup */\n  parseText(response, silent, translate) {\n    var doc = this.stripScripts(response),\n        fragment = this.makeFragment(doc);\n\n    if (fragment) {\n      let stopIndex = null;\n      let tr = fragment.querySelectorAll('#meaning_div>table>tbody>tr');\n      tr = Array.prototype.slice.call(tr);\n\n      let trans = tr.filter(function (tr, index) {\n         if (!isNaN(parseInt(stopIndex, 10)) && index >= stopIndex) {return;}\n         else {\n            tr = $(tr);\n            // take every row before next section (which is English->English)\n            if (tr.attr('bgcolor') == \"e0e6ff\") {stopIndex = index; return;}\n            else {return ($.trim(tr.find('td').text())).length}\n         }\n      });\n      trans = trans.slice(1, trans.length - 1);\n      trans = trans.filter(function (el, indx) { return indx % 2; })\n      let frag = this.fragmentFromList(trans);\n      let fonts = frag.querySelectorAll('font')\n      let text = '';\n      for (var i=0; i < fonts.length; i++ ) {\n        text += ' ' + fonts[i].textContent.trim();\n      }\n      return text;\n    } else {\n      throw \"HTML fragment could not be parsed\";\n    }\n  }\n\n  //TODO extract to base engine class\n  /* removes <script> tags from html code */\n  stripScripts (html) {\n    var div = document.createElement('div');\n    div.innerHTML = html;\n    var scripts = div.getElementsByTagName('script');\n    let i = scripts.length;\n    while (i--)\n      scripts[i].parentNode.removeChild(scripts[i]);\n    return div.innerHTML;\n  }\n\n  //TODO extract to base engine class\n  /* creates temp object to parse translation from page \n    (since it's not a friendly api) \n  */\n  makeFragment (html) {\n    var fragment = document.createDocumentFragment(),\n        div = document.createElement(\"div\");\n    div.innerHTML = html;\n    while ( div.firstChild ) {\n      fragment.appendChild( div.firstChild );\n    }\n    return fragment;\n  }\n\n  /** create fragment from list of DOM elements */\n  fragmentFromList (list) {\n    var fragment = document.createDocumentFragment(), len = list.length;\n    while(len--){\n      fragment.appendChild(list[len]);\n    }\n    return fragment;\n  }\n}\n\n// Singletone\nmodule.exports = new TurkishDictionary();"]}