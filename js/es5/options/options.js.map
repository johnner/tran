{"version":3,"sources":["js/es6/options/options.js"],"names":[],"mappings":"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","file":"js/es6/options/options.js","sourcesContent":["var _ = require('../utils.js');\nvar SERVICE_URL = 'http://tran-service.com/api/user/';\n\nclass Options {\n  constructor () {\n    this.signed = document.getElementById('signed');\n    this.needSign = document.getElementById('need-sign');\n  }\n\n  /** Restores select box and checkbox state using\n   * the preferences stored in chrome.storage.*/\n  restore () {\n    // Use default value language is 'english' and fast translate is true\n    var defaults = {\n      language: '1',\n      fast: true,\n      memorize: false\n    };\n    this.storage('get', defaults, this.onRestore);\n  }\n\n  /** Saves options to chrome.storage */\n  save (params={restored:false}) {\n    // save options if only it is not restored onload\n    if (!params.restored) {\n      this.storage('set', this.options, this.onSave)\n    } else {\n      this.memorize();\n    }\n  }\n\n  onSave () {\n    // let user know that options are saved.\n    var status = document.getElementById('status');\n    status.textContent = 'Options saved.';\n    let hideStatus = function () { status.textContent = ''};\n    this.memorize();\n    setTimeout(hideStatus, 750);\n  }\n\n  /** Handler of success options restore */\n  onRestore (items) {\n      // set checkboxes\n      this.options = items;\n      this.save({restored:true})\n  }\n\n  /** chrome storage wrapper */\n  storage (op, data, cb) {\n    cb = cb.bind(this)\n    if (op == 'set') {\n      chrome.storage.sync.set(data, evt => cb(evt));\n    } else if (op == 'get') {\n      chrome.storage.sync.get(data, evt => cb(evt));\n    }\n  }\n\n  /** toggle memorize option */\n  memorize () {\n    if (this.options.memorize) {\n      this.check_auth().then(\n        res => this.authorized = true,\n        res => this.authorized = false\n    )\n    } else {\n      this.revoke();\n      this.signed.classList.add('hidden');\n      this.needSign.classList.add('hidden');\n    }\n  }\n\n  check_login () {\n    _.get(SERVICE_URL).then(\n      res => this.memok(res),\n      res => this.memfail(res)\n    );\n  }\n\n  /** memorization is activated */\n  memok (response) {\n    this.authorized = true;\n  }\n\n  /** memorization failed */\n  memfail (response) {\n      this.authorized = false;\n  }\n\n  get options () {\n    return {\n        language: document.getElementById('language').value,\n        fast: document.getElementById('fast').checked,\n        memorize: document.getElementById('memorize').checked\n    }\n  }\n\n  set options (values) {\n      document.getElementById('language').value = values.language;\n      document.getElementById('fast').checked = values.fast;\n      document.getElementById('memorize').checked = values.memorize;\n  }\n\n  set authorized (state) {\n    if (this.options.memorize) {\n      if (state) {\n        this.signed.classList.remove('hidden');\n        this.needSign.classList.add('hidden');\n      } else {\n        this.needSign.classList.remove('hidden');\n        this.signed.classList.add('hidden');\n      }\n    }\n  }\n\n  check_auth () {\n    return new Promise(function(resolve, reject) {\n      this.storage('get', 'auth_token', function (data) {\n        if (!data.auth_token) {\n          reject();\n        } else {\n          _.get(SERVICE_URL, {headers:{'X-AUTH-TOKEN': data.auth_token}}).then(\n            res => resolve(res),\n            res => reject(res)\n          )\n        }\n      }.bind(this));\n    }.bind(this));\n  }\n\n  signin () {\n    var cred = {\n      login: document.getElementById('login').value,\n      password: document.getElementById('password').value\n    }\n\n    _.post(SERVICE_URL, {data:cred}).then(\n      res => this.authSuccess(res),\n      res => this.authFail(res)\n    )\n  }\n\n  authSuccess(data) {\n    this.storage('set', {'auth_token': data}, data => this.save());\n    this.authorized = true;\n  }\n\n  authFail (data) {\n    console.log('fail auth', data);\n    var status = document.querySelector('.error-login')\n    status.textContent = 'Bad login or password.'\n    let hideStatus = function () { status.textContent = ''}\n    setTimeout(hideStatus, 2750);\n  }\n\n  revoke (event) {\n    event && event.preventDefault();\n    this.storage('set', {'auth_token': null}, function (data) {\n      this.authorized = false;\n    }.bind(this));\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', function(event) {\n  var options = new Options();\n  options.restore();\n  document.getElementById('save').addEventListener('click', evt=> options.save());\n  document.getElementById('memorize').addEventListener('click', evt=> options.memorize());\n  document.getElementById('signinBtn').addEventListener('click', evt=> options.signin());\n  document.querySelector('#revoke').addEventListener( 'click', evt=> options.revoke(evt))\n});\n"]}